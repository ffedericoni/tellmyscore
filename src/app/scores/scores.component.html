<div class="container">
    <!-- Editable Title -->
    <h1>
        <input [(ngModel)]="title" (ngModelChange)="title.set($event)" class="form-control input-lg"
            style="border:none;box-shadow:none;background:transparent;padding:0;height:auto;">
    </h1>

    <div *ngIf="players().length === 0" class="alert alert-danger">
        {{ 'SCORES.NO_PLAYERS_PREFIX' | translate }} <a routerLink="/players" class="alert-link">{{
            'SCORES.NO_PLAYERS_LINK' | translate }}</a> {{ 'SCORES.NO_PLAYERS_SUFFIX' | translate }}
    </div>

    <p *ngIf="running()">{{ 'SCORES.STARTED' | translate }} {{ started() | date:'short' }}</p>

    <div class="scores-table" *ngIf="players().length > 0">
        <table class="table">
            <thead>
                <tr>
                    <th>{{ 'SCORES.ROUND' | translate }}</th>
                    <th *ngFor="let player of players()" [class.success]="winners().includes(player.id)">
                        {{player.name}}
                    </th>
                    <th></th>
                </tr>
            </thead>
            <tfoot>
                <tr>
                    <th>{{ 'SCORES.TOTALS' | translate }}</th>
                    <th class="totals number" *ngFor="let player of players()"
                        [class.success]="winners().includes(player.id)">
                        {{totals()[player.id] || 0}}
                    </th>
                    <th></th>
                </tr>
            </tfoot>
            <tbody>
                <tr *ngFor="let row of rows(); let i = index; let isLast = last" [class.active]="isLast && running()"
                    [class.completed]="!isLast || !running()">
                    <th>{{i + 1}}</th>
                    <td class="number" *ngFor="let player of players()">
                        <form (submit)="newRow()">
                            <input class="form-control score-input" type="tel" [(ngModel)]="row[player.id]"
                                [ngModelOptions]="{standalone: true}" (change)="updateTotals(player)"
                                [disabled]="!!finished()">
                        </form>
                    </td>
                    <td>
                        <button *ngIf="running() && isLast" class="btn btn-success" (click)="newRow()">
                            <i class="fa fa-plus"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Winners Alert -->
    <div *ngIf="winners().length > 0" class="alert alert-success">
        <span *ngIf="winners().length > 1">{{ 'SCORES.TIE_TITLE' | translate }}</span>
        <span *ngIf="winners().length === 1">{{ 'SCORES.WINNER_TITLE' | translate }}</span>
        <!-- Name pipes needed or simple lookup -->
    </div>

    <!-- Toolbar -->
    <div *ngIf="players().length > 0" class="toolbar-right">
        <button class="btn btn-default" (click)="showSettings.set(true)">
            <i class="fa fa-wrench"></i>
        </button>
        <button class="btn btn-info" (click)="announce()">
            <i class="fa fa-volume-up"></i> {{ 'SCORES.ANNOUNCE' | translate }}
        </button>

        <button class="btn btn-default" *ngIf="!running() && finished()" (click)="resume()">
            <i class="fa fa-history"></i> {{ 'SCORES.RESUME' | translate }}
        </button>

        <button class="btn btn-primary" *ngIf="!running()" (click)="start()">
            <i class="fa fa-caret-square-o-right"></i> {{ 'SCORES.START' | translate }} <span *ngIf="finished()">{{
                'SCORES.NEW' | translate }}</span>
        </button>

        <button class="btn btn-danger" *ngIf="running()" (click)="abort()">
            <i class="fa fa-trash-o"></i> {{ 'SCORES.ABORT' | translate }}
        </button>

        <button class="btn btn-success" *ngIf="running()" (click)="finish()">
            <i class="fa fa-check-square-o"></i> {{ 'SCORES.FINISH' | translate }}
        </button>
    </div>

    <app-settings *ngIf="showSettings()" (close)="showSettings.set(false)"></app-settings>
</div>