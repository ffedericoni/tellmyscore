import{i as E,S as U,v as X,w as $,x as T,y as x,ɵ as L,C as A,N as D,c as r,h as u,f as a,d as l,j as I,q as M,g as b,l as i,z as f,p as O,o as g,A as K,a as Q,D as J,R as Z,B as tt,T as et,b as nt,e as d,u as p,E as st,F as ot,n as h,k as C,m as v,r as w,G as F,s as m,t as S,H as it}from"./index-Bvynm-1g.js";import{F as W,ɵ as B,d as at,e as rt,D as z,f as ct,S as lt,N as q,a as Y,b as j,c as G}from"./forms-BqKJ-aQp.js";function _t(o,e){if(o&1&&(r(0,"option",21),l(1),a()),o&2){const t=e.$implicit;g("value",t.voiceURI),i(),f(" ",t.name," ")}}const R=class R{constructor(){this.storage=E(U),this.close=X(),this.translate=E($),this.settings=this.storage.tts,this.allVoices=T([]),this.filteredVoices=T([]),this.loadVoices(),window.speechSynthesis&&(window.speechSynthesis.onvoiceschanged=()=>this.loadVoices()),x(()=>{const e=this.settings().language;this.filterVoices(e);const t=e.substring(0,2);this.translate.use(t)})}loadVoices(){if(!window.speechSynthesis)return;const e=window.speechSynthesis.getVoices();this.allVoices.set(e),this.filterVoices(this.settings().language)}filterVoices(e){const t=this.allVoices();if(!t.length)return;const n=e.substring(0,2),s=t.filter(c=>c.lang.startsWith(n));this.filteredVoices.set(s.length?s:t)}updateSetting(e,t){this.storage.tts.update(n=>({...n,[e]:t}))}get rate(){return this.settings().rate}set rate(e){this.updateSetting("rate",e)}get pitch(){return this.settings().pitch}set pitch(e){this.updateSetting("pitch",e)}get language(){return this.settings().language}set language(e){this.storage.tts.update(t=>({...t,language:e,voiceURI:null}))}get voiceURI(){return this.settings().voiceURI}set voiceURI(e){this.updateSetting("voiceURI",e)}test(){if(!window.speechSynthesis)return;const e=this.settings(),t=e.language==="it-IT"?"Questa è una prova della voce selezionata.":"This is a test of the selected voice.",n=new SpeechSynthesisUtterance(t);if(n.rate=e.rate,n.pitch=e.pitch,n.lang=e.language,e.voiceURI){const s=this.allVoices().find(c=>c.voiceURI===e.voiceURI);s&&(n.voice=s)}window.speechSynthesis.speak(n)}onClose(){this.close.emit()}};R.ɵfac=function(t){return new(t||R)},R.ɵcmp=L({type:R,selectors:[["app-settings"]],outputs:{close:"close"},decls:38,vars:8,consts:[[1,"modal-backdrop",3,"click"],["tabindex","-1","role","dialog",1,"modal"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-3"],[1,"form-label"],["type","range","min","0.5","max","2","step","0.1","name","rate",1,"form-range",3,"ngModelChange","ngModel"],["type","range","min","0","max","2","step","0.1","name","pitch",1,"form-range",3,"ngModelChange","ngModel"],["name","language",1,"form-select",3,"ngModelChange","ngModel"],["value","en-US"],["value","it-IT"],["name","voiceURI",1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-info",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[3,"value"]],template:function(t,n){t&1&&(r(0,"div",0),u("click",function(){return n.onClose()}),a(),r(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),l(6,"TTS Settings"),a(),r(7,"button",6),u("click",function(){return n.onClose()}),a()(),r(8,"div",7)(9,"form")(10,"div",8)(11,"label",9),l(12),a(),r(13,"input",10),I("ngModelChange",function(c){return M(n.rate,c)||(n.rate=c),c}),a()(),r(14,"div",8)(15,"label",9),l(16),a(),r(17,"input",11),I("ngModelChange",function(c){return M(n.pitch,c)||(n.pitch=c),c}),a()(),r(18,"div",8)(19,"label",9),l(20,"Language"),a(),r(21,"select",12),I("ngModelChange",function(c){return M(n.language,c)||(n.language=c),c}),r(22,"option",13),l(23,"English"),a(),r(24,"option",14),l(25,"Italiano"),a()()(),r(26,"div",8)(27,"label",9),l(28,"Voice"),a(),r(29,"select",15),I("ngModelChange",function(c){return M(n.voiceURI,c)||(n.voiceURI=c),c}),r(30,"option",16),l(31,"Default"),a(),b(32,_t,2,2,"option",17),a()()()(),r(33,"div",18)(34,"button",19),u("click",function(){return n.test()}),l(35,"Test Voice"),a(),r(36,"button",20),u("click",function(){return n.onClose()}),l(37,"Close"),a()()()()()),t&2&&(i(12),f("Rate (Speed): ",n.rate,""),i(),O("ngModel",n.rate),i(3),f("Pitch: ",n.pitch,""),i(),O("ngModel",n.pitch),i(4),O("ngModel",n.language),i(8),O("ngModel",n.voiceURI),i(),g("ngValue",null),i(2),g("ngForOf",n.filteredVoices()))},dependencies:[A,D,W,B,at,rt,z,ct,lt,q,Y,j,G],styles:[`.modal-backdrop[_ngcontent-%COMP%] {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1040;
    }
    .modal[_ngcontent-%COMP%] {
      display: block;
      z-index: 1050;
    }`]});let P=R;const gt=()=>({standalone:!0});function pt(o,e){o&1&&(r(0,"div",8),l(1),d(2,"translate"),r(3,"a",9),l(4),d(5,"translate"),a(),l(6),d(7,"translate"),a()),o&2&&(i(),f(" ",h(2,3,"SCORES.NO_PLAYERS_PREFIX")," "),i(3),v(h(5,5,"SCORES.NO_PLAYERS_LINK")),i(2),f(" ",h(7,7,"SCORES.NO_PLAYERS_SUFFIX")," "))}function ut(o,e){if(o&1&&(r(0,"p"),l(1),d(2,"translate"),d(3,"date"),a()),o&2){const t=p();i(),st("",h(2,2,"SCORES.STARTED")," ",ot(3,4,t.started(),"short"),"")}}function dt(o,e){if(o&1&&(r(0,"th"),l(1),a()),o&2){const t=e.$implicit,n=p(2);F("success",n.winners().includes(t.id)),i(),f(" ",t.name," ")}}function ht(o,e){if(o&1&&(r(0,"th",15),l(1),a()),o&2){const t=e.$implicit,n=p(2);F("success",n.winners().includes(t.id)),i(),f(" ",n.totals()[t.id]||0," ")}}function ft(o,e){if(o&1){const t=w();r(0,"td",18)(1,"form",19),u("submit",function(){m(t);const s=p(3);return S(s.newRow())}),r(2,"input",20),I("ngModelChange",function(s){const c=m(t).$implicit,_=p().$implicit;return M(_[c.id],s)||(_[c.id]=s),S(s)}),u("change",function(){const s=m(t).$implicit,c=p(3);return S(c.updateTotals(s))}),a()()()}if(o&2){const t=e.$implicit,n=p().$implicit,s=p(2);i(2),O("ngModel",n[t.id]),g("ngModelOptions",it(3,gt))("disabled",!!s.finished())}}function mt(o,e){if(o&1){const t=w();r(0,"button",21),u("click",function(){m(t);const s=p(3);return S(s.newRow())}),C(1,"i",22),a()}}function St(o,e){if(o&1&&(r(0,"tr")(1,"th"),l(2),a(),b(3,ft,3,4,"td",16),r(4,"td"),b(5,mt,2,0,"button",17),a()()),o&2){const t=e.index,n=e.last,s=p(2);F("active",n&&s.running())("completed",!n||!s.running()),i(2),v(t+1),i(),g("ngForOf",s.players()),i(2),g("ngIf",s.running()&&n)}}function bt(o,e){if(o&1&&(r(0,"div",10)(1,"table",11)(2,"thead")(3,"tr")(4,"th"),l(5),d(6,"translate"),a(),b(7,dt,2,3,"th",12),C(8,"th"),a()(),r(9,"tfoot")(10,"tr")(11,"th"),l(12),d(13,"translate"),a(),b(14,ht,2,3,"th",13),C(15,"th"),a()(),r(16,"tbody"),b(17,St,6,7,"tr",14),a()()()),o&2){const t=p();i(5),v(h(6,5,"SCORES.ROUND")),i(2),g("ngForOf",t.players()),i(5),v(h(13,7,"SCORES.TOTALS")),i(2),g("ngForOf",t.players()),i(3),g("ngForOf",t.rows())}}function Ct(o,e){o&1&&(r(0,"span"),l(1),d(2,"translate"),a()),o&2&&(i(),v(h(2,1,"SCORES.TIE_TITLE")))}function wt(o,e){o&1&&(r(0,"span"),l(1),d(2,"translate"),a()),o&2&&(i(),v(h(2,1,"SCORES.WINNER_TITLE")))}function Tt(o,e){if(o&1&&(r(0,"div",23),b(1,Ct,3,3,"span",3)(2,wt,3,3,"span",3),a()),o&2){const t=p();i(),g("ngIf",t.winners().length>1),i(),g("ngIf",t.winners().length===1)}}function vt(o,e){if(o&1){const t=w();r(0,"button",25),u("click",function(){m(t);const s=p(2);return S(s.resume())}),C(1,"i",32),l(2),d(3,"translate"),a()}o&2&&(i(2),f(" ",h(3,1,"SCORES.RESUME")," "))}function yt(o,e){o&1&&(r(0,"span"),l(1),d(2,"translate"),a()),o&2&&(i(),v(h(2,1,"SCORES.NEW")))}function It(o,e){if(o&1){const t=w();r(0,"button",33),u("click",function(){m(t);const s=p(2);return S(s.start())}),C(1,"i",34),l(2),d(3,"translate"),b(4,yt,3,3,"span",3),a()}if(o&2){const t=p(2);i(2),f(" ",h(3,2,"SCORES.START")," "),i(2),g("ngIf",t.finished())}}function Mt(o,e){if(o&1){const t=w();r(0,"button",35),u("click",function(){m(t);const s=p(2);return S(s.abort())}),C(1,"i",36),l(2),d(3,"translate"),a()}o&2&&(i(2),f(" ",h(3,1,"SCORES.ABORT")," "))}function Ot(o,e){if(o&1){const t=w();r(0,"button",21),u("click",function(){m(t);const s=p(2);return S(s.finish())}),C(1,"i",37),l(2),d(3,"translate"),a()}o&2&&(i(2),f(" ",h(3,1,"SCORES.FINISH")," "))}function Rt(o,e){if(o&1){const t=w();r(0,"div",24)(1,"button",25),u("click",function(){m(t);const s=p();return S(s.showSettings.set(!0))}),C(2,"i",26),a(),r(3,"button",27),u("click",function(){m(t);const s=p();return S(s.announce())}),C(4,"i",28),l(5),d(6,"translate"),a(),b(7,vt,4,3,"button",29)(8,It,5,4,"button",30)(9,Mt,4,3,"button",31)(10,Ot,4,3,"button",17),a()}if(o&2){const t=p();i(5),f(" ",h(6,5,"SCORES.ANNOUNCE")," "),i(2),g("ngIf",!t.running()&&t.finished()),i(),g("ngIf",!t.running()),i(),g("ngIf",t.running()),i(),g("ngIf",t.running())}}function kt(o,e){if(o&1){const t=w();r(0,"app-settings",38),u("close",function(){m(t);const s=p();return S(s.showSettings.set(!1))}),a()}}const k=class k{constructor(){this.storage=E(U),this.players=this.storage.players,this.title=this.storage.title,this.rows=this.storage.rows,this.started=this.storage.started,this.finished=this.storage.finished,this.tts=this.storage.tts,this.running=K(()=>!!this.started()&&!this.finished()),this.activeRowIndex=T(-1),this.winners=T([]),this.totals=T({}),this.announcementText=T(""),this.showSettings=T(!1),x(()=>{this.rows().length>0&&this.recalculateTotals()}),x(()=>{this.started()&&this.finished()})}start(){this.storage.rows.set([]),this.storage.finished.set(null),this.storage.started.set(new Date().toISOString()),this.winners.set([]),this.newRow()}resume(){this.storage.finished.set(null),this.newRow()}abort(){this.storage.started.set(null),this.storage.finished.set(null),this.storage.rows.set([]),this.winners.set([]),this.totals.set({})}finish(){this.storage.finished.set(new Date().toISOString());const e={title:this.title(),started:this.started(),finished:this.finished(),players:this.players(),totals:this.totals()};this.storage.games.update(t=>[e,...t]),this.cleanupEmptyRows(),this.calculateWinners()}newRow(){const e={};for(const t of this.players())e[t.id]="";this.storage.rows.update(t=>[...t,e])}updateTotals(e){this.recalculateTotals(),this.storage.rows.update(t=>[...t])}recalculateTotals(){const e={};for(const t of this.players()){let n=0;for(const s of this.rows())n+=this.parseScore(s[t.id]);e[t.id]=n}this.totals.set(e),this.calculateWinners()}calculateWinners(){let e=-1/0,t=[];const n=this.totals();for(const s in n)n[s]>e?(e=n[s],t=[s]):n[s]===e&&t.push(s);this.winners.set(t)}cleanupEmptyRows(){const e=this.rows();e.length>0&&this.isRowEmpty(e[e.length-1])&&this.storage.rows.update(t=>t.slice(0,-1))}isRowEmpty(e){for(const t in e)if(this.parseScore(e[t])!==0)return!1;return!0}parseScore(e){if(!e)return 0;typeof e=="string"&&(e=e.replace(",","."));const t=parseFloat(e);return isNaN(t)?0:t}announce(){const e=this.totals(),t=[...this.players()].map(_=>({name:_.name,score:e[_.id]||0})).sort((_,y)=>y.score-_.score),n=this.tts();let s=n?.language;if(!s){const _=navigator.language;s=_&&_.indexOf("it")===0?"it-IT":"en-US"}let c="";if(s==="it-IT"){c="I punteggi attuali sono: ";for(const _ of t){const y=_.score===1?" punto. ":" punti. ";c+=`${_.name} con ${_.score}${y}`}}else{c="The current scores are: ";for(const _ of t){const y=_.score===1?" point. ":" points. ";c+=`${_.name} with ${_.score}${y}`}}this.announcementText.set(c),"speechSynthesis"in window?(window.speechSynthesis.cancel(),setTimeout(()=>{const _=new SpeechSynthesisUtterance(c);if(_.rate=n?.rate||.8,_.pitch=n?.pitch||1,_.lang=s,n?.voiceURI){const N=window.speechSynthesis.getVoices().find(H=>H.voiceURI===n.voiceURI);N&&(_.voice=N)}window.speechSynthesis.speak(_)},100)):console.warn("TTS not supported")}};k.ɵfac=function(t){return new(t||k)},k.ɵcmp=L({type:k,selectors:[["app-scores"]],decls:9,vars:7,consts:[[1,"container"],[1,"form-control","input-lg",2,"border","none","box-shadow","none","background","transparent","padding","0","height","auto",3,"ngModelChange","ngModel"],["class","alert alert-danger",4,"ngIf"],[4,"ngIf"],["class","scores-table",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["class","toolbar-right",4,"ngIf"],[3,"close",4,"ngIf"],[1,"alert","alert-danger"],["routerLink","/players",1,"alert-link"],[1,"scores-table"],[1,"table"],[3,"success",4,"ngFor","ngForOf"],["class","totals number",3,"success",4,"ngFor","ngForOf"],[3,"active","completed",4,"ngFor","ngForOf"],[1,"totals","number"],["class","number",4,"ngFor","ngForOf"],["class","btn btn-success",3,"click",4,"ngIf"],[1,"number"],[3,"submit"],["type","tel",1,"form-control","score-input",3,"ngModelChange","change","ngModel","ngModelOptions","disabled"],[1,"btn","btn-success",3,"click"],[1,"fa","fa-plus"],[1,"alert","alert-success"],[1,"toolbar-right"],[1,"btn","btn-default",3,"click"],[1,"fa","fa-wrench"],[1,"btn","btn-info",3,"click"],[1,"fa","fa-volume-up"],["class","btn btn-default",3,"click",4,"ngIf"],["class","btn btn-primary",3,"click",4,"ngIf"],["class","btn btn-danger",3,"click",4,"ngIf"],[1,"fa","fa-history"],[1,"btn","btn-primary",3,"click"],[1,"fa","fa-caret-square-o-right"],[1,"btn","btn-danger",3,"click"],[1,"fa","fa-trash-o"],[1,"fa","fa-check-square-o"],[3,"close"]],template:function(t,n){t&1&&(r(0,"div",0)(1,"h1")(2,"input",1),I("ngModelChange",function(c){return M(n.title,c)||(n.title=c),c}),u("ngModelChange",function(c){return n.title.set(c)}),a()(),b(3,pt,8,9,"div",2)(4,ut,4,7,"p",3)(5,bt,18,9,"div",4)(6,Tt,3,2,"div",5)(7,Rt,11,7,"div",6)(8,kt,1,0,"app-settings",7),a()),t&2&&(i(2),O("ngModel",n.title),i(),g("ngIf",n.players().length===0),i(),g("ngIf",n.running()),i(),g("ngIf",n.players().length>0),i(),g("ngIf",n.winners().length>0),i(),g("ngIf",n.players().length>0),i(),g("ngIf",n.showSettings()))},dependencies:[A,D,Q,J,W,B,z,q,Y,j,G,Z,tt,P,et,nt],styles:[`.scores-table[_ngcontent-%COMP%]   .score-input[_ngcontent-%COMP%] {
  width: 80%;
  min-width: 3em;
  text-align: right;
}
.scores-table[_ngcontent-%COMP%]   tr.completed[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] {
  border: none;
  background-color: transparent;
  -webkit-text-fill-color: #333;
}
.scores-table[_ngcontent-%COMP%]   tr.active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] {
  vertical-align: middle;
}
.scores-table[_ngcontent-%COMP%]   th.number[_ngcontent-%COMP%], 
.scores-table[_ngcontent-%COMP%]   td.number[_ngcontent-%COMP%] {
  text-align: right;
}
.scores-table[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%]   th.number[_ngcontent-%COMP%] {
  padding-right: 0.7em;
}
.scores-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {
  text-align: center;
}`]});let V=k;export{V as ScoresComponent};
