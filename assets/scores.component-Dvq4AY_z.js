import{i as V,r as $,s as C,t as k,ɵ as F,C as U,N,b as a,f as u,d as i,c as l,g as S,m as v,e as f,j as c,u as I,l as y,k as g,v as G,a as Q,D as H,R as J,w as K,x as X,q as p,y as Y,h as m,n as b,z as R,A as Z,o as d,p as h,B as tt}from"./index-BH9wt9iL.js";import{F as W,ɵ as A,d as et,e as nt,D,f as st,S as ot,N as E,a as L,b as z,c as q}from"./forms-D5ou3R0r.js";import{S as B}from"./storage.service-BAQ0acWl.js";function it(o,e){if(o&1&&(a(0,"option",21),l(1),i()),o&2){const t=e.$implicit;g("value",t.voiceURI),c(),I(" ",t.name," ")}}const T=class T{constructor(){this.storage=V(B),this.close=$(),this.settings=this.storage.tts,this.allVoices=C([]),this.filteredVoices=C([]),this.loadVoices(),window.speechSynthesis&&(window.speechSynthesis.onvoiceschanged=()=>this.loadVoices()),k(()=>{const e=this.settings().language;this.filterVoices(e)})}loadVoices(){if(!window.speechSynthesis)return;const e=window.speechSynthesis.getVoices();this.allVoices.set(e),this.filterVoices(this.settings().language)}filterVoices(e){const t=this.allVoices();if(!t.length)return;const n=e.substring(0,2),s=t.filter(r=>r.lang.startsWith(n));this.filteredVoices.set(s.length?s:t)}updateSetting(e,t){this.storage.tts.update(n=>({...n,[e]:t}))}get rate(){return this.settings().rate}set rate(e){this.updateSetting("rate",e)}get pitch(){return this.settings().pitch}set pitch(e){this.updateSetting("pitch",e)}get language(){return this.settings().language}set language(e){this.storage.tts.update(t=>({...t,language:e,voiceURI:null}))}get voiceURI(){return this.settings().voiceURI}set voiceURI(e){this.updateSetting("voiceURI",e)}test(){if(!window.speechSynthesis)return;const e=this.settings(),t=e.language==="it-IT"?"Questa è una prova della voce selezionata.":"This is a test of the selected voice.",n=new SpeechSynthesisUtterance(t);if(n.rate=e.rate,n.pitch=e.pitch,n.lang=e.language,e.voiceURI){const s=this.allVoices().find(r=>r.voiceURI===e.voiceURI);s&&(n.voice=s)}window.speechSynthesis.speak(n)}onClose(){this.close.emit()}};T.ɵfac=function(t){return new(t||T)},T.ɵcmp=F({type:T,selectors:[["app-settings"]],outputs:{close:"close"},decls:38,vars:8,consts:[[1,"modal-backdrop",3,"click"],["tabindex","-1","role","dialog",1,"modal"],["role","document",1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"mb-3"],[1,"form-label"],["type","range","min","0.5","max","2","step","0.1","name","rate",1,"form-range",3,"ngModelChange","ngModel"],["type","range","min","0","max","2","step","0.1","name","pitch",1,"form-range",3,"ngModelChange","ngModel"],["name","language",1,"form-select",3,"ngModelChange","ngModel"],["value","en-US"],["value","it-IT"],["name","voiceURI",1,"form-select",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"value",4,"ngFor","ngForOf"],[1,"modal-footer"],["type","button",1,"btn","btn-info",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],[3,"value"]],template:function(t,n){t&1&&(a(0,"div",0),u("click",function(){return n.onClose()}),i(),a(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"h5",5),l(6,"TTS Settings"),i(),a(7,"button",6),u("click",function(){return n.onClose()}),i()(),a(8,"div",7)(9,"form")(10,"div",8)(11,"label",9),l(12),i(),a(13,"input",10),S("ngModelChange",function(r){return v(n.rate,r)||(n.rate=r),r}),i()(),a(14,"div",8)(15,"label",9),l(16),i(),a(17,"input",11),S("ngModelChange",function(r){return v(n.pitch,r)||(n.pitch=r),r}),i()(),a(18,"div",8)(19,"label",9),l(20,"Language"),i(),a(21,"select",12),S("ngModelChange",function(r){return v(n.language,r)||(n.language=r),r}),a(22,"option",13),l(23,"English"),i(),a(24,"option",14),l(25,"Italiano"),i()()(),a(26,"div",8)(27,"label",9),l(28,"Voice"),i(),a(29,"select",15),S("ngModelChange",function(r){return v(n.voiceURI,r)||(n.voiceURI=r),r}),a(30,"option",16),l(31,"Default"),i(),f(32,it,2,2,"option",17),i()()()(),a(33,"div",18)(34,"button",19),u("click",function(){return n.test()}),l(35,"Test Voice"),i(),a(36,"button",20),u("click",function(){return n.onClose()}),l(37,"Close"),i()()()()()),t&2&&(c(12),I("Rate (Speed): ",n.rate,""),c(),y("ngModel",n.rate),c(3),I("Pitch: ",n.pitch,""),c(),y("ngModel",n.pitch),c(4),y("ngModel",n.language),c(8),y("ngModel",n.voiceURI),c(),g("ngValue",null),c(2),g("ngForOf",n.filteredVoices()))},dependencies:[U,N,W,A,et,nt,D,st,ot,E,L,z,q],styles:[`.modal-backdrop[_ngcontent-%COMP%] {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      z-index: 1040;
    }
    .modal[_ngcontent-%COMP%] {
      display: block;
      z-index: 1050;
    }`]});let O=T;const at=()=>({standalone:!0});function rt(o,e){o&1&&(a(0,"div",8),l(1," No players defined. "),a(2,"a",9),l(3,"Add Players"),i(),l(4," first. "),i())}function ct(o,e){if(o&1&&(a(0,"p"),l(1),X(2,"date"),i()),o&2){const t=p();c(),I("Started ",Y(2,1,t.started(),"short"),"")}}function lt(o,e){if(o&1&&(a(0,"th"),l(1),i()),o&2){const t=e.$implicit,n=p(2);R("success",n.winners().includes(t.id)),c(),I(" ",t.name," ")}}function _t(o,e){if(o&1&&(a(0,"th",15),l(1),i()),o&2){const t=e.$implicit,n=p(2);R("success",n.winners().includes(t.id)),c(),I(" ",n.totals()[t.id]||0," ")}}function gt(o,e){if(o&1){const t=b();a(0,"td",18)(1,"form",19),u("submit",function(){d(t);const s=p(3);return h(s.newRow())}),a(2,"input",20),S("ngModelChange",function(s){const r=d(t).$implicit,_=p().$implicit;return v(_[r.id],s)||(_[r.id]=s),h(s)}),u("change",function(){const s=d(t).$implicit,r=p(3);return h(r.updateTotals(s))}),i()()()}if(o&2){const t=e.$implicit,n=p().$implicit,s=p(2);c(2),y("ngModel",n[t.id]),g("ngModelOptions",tt(3,at))("disabled",!!s.finished())}}function pt(o,e){if(o&1){const t=b();a(0,"button",21),u("click",function(){d(t);const s=p(3);return h(s.newRow())}),m(1,"i",22),i()}}function ut(o,e){if(o&1&&(a(0,"tr")(1,"th"),l(2),i(),f(3,gt,3,4,"td",16),a(4,"td"),f(5,pt,2,0,"button",17),i()()),o&2){const t=e.index,n=e.last,s=p(2);R("active",n&&s.running())("completed",!n||!s.running()),c(2),Z(t+1),c(),g("ngForOf",s.players()),c(2),g("ngIf",s.running()&&n)}}function dt(o,e){if(o&1&&(a(0,"div",10)(1,"table",11)(2,"thead")(3,"tr")(4,"th"),l(5,"Round"),i(),f(6,lt,2,3,"th",12),m(7,"th"),i()(),a(8,"tfoot")(9,"tr")(10,"th"),l(11,"Totals"),i(),f(12,_t,2,3,"th",13),m(13,"th"),i()(),a(14,"tbody"),f(15,ut,6,7,"tr",14),i()()()),o&2){const t=p();c(6),g("ngForOf",t.players()),c(6),g("ngForOf",t.players()),c(3),g("ngForOf",t.rows())}}function ht(o,e){o&1&&(a(0,"span"),l(1,"It's a tie!"),i())}function ft(o,e){o&1&&(a(0,"span"),l(1,"Winner!"),i())}function mt(o,e){if(o&1&&(a(0,"div",23),f(1,ht,2,0,"span",3)(2,ft,2,0,"span",3),i()),o&2){const t=p();c(),g("ngIf",t.winners().length>1),c(),g("ngIf",t.winners().length===1)}}function bt(o,e){if(o&1){const t=b();a(0,"button",25),u("click",function(){d(t);const s=p(2);return h(s.resume())}),m(1,"i",32),l(2," Resume "),i()}}function Ct(o,e){o&1&&(a(0,"span"),l(1,"New"),i())}function wt(o,e){if(o&1){const t=b();a(0,"button",33),u("click",function(){d(t);const s=p(2);return h(s.start())}),m(1,"i",34),l(2," Start "),f(3,Ct,2,0,"span",3),i()}if(o&2){const t=p(2);c(3),g("ngIf",t.finished())}}function St(o,e){if(o&1){const t=b();a(0,"button",35),u("click",function(){d(t);const s=p(2);return h(s.abort())}),m(1,"i",36),l(2," Abort "),i()}}function vt(o,e){if(o&1){const t=b();a(0,"button",21),u("click",function(){d(t);const s=p(2);return h(s.finish())}),m(1,"i",37),l(2," Finish "),i()}}function yt(o,e){if(o&1){const t=b();a(0,"div",24)(1,"button",25),u("click",function(){d(t);const s=p();return h(s.showSettings.set(!0))}),m(2,"i",26),i(),a(3,"button",27),u("click",function(){d(t);const s=p();return h(s.announce())}),m(4,"i",28),l(5," Announce "),i(),f(6,bt,3,0,"button",29)(7,wt,4,1,"button",30)(8,St,3,0,"button",31)(9,vt,3,0,"button",17),i()}if(o&2){const t=p();c(6),g("ngIf",!t.running()&&t.finished()),c(),g("ngIf",!t.running()),c(),g("ngIf",t.running()),c(),g("ngIf",t.running())}}function Tt(o,e){if(o&1){const t=b();a(0,"app-settings",38),u("close",function(){d(t);const s=p();return h(s.showSettings.set(!1))}),i()}}const M=class M{constructor(){this.storage=V(B),this.players=this.storage.players,this.title=this.storage.title,this.rows=this.storage.rows,this.started=this.storage.started,this.finished=this.storage.finished,this.tts=this.storage.tts,this.running=G(()=>!!this.started()&&!this.finished()),this.activeRowIndex=C(-1),this.winners=C([]),this.totals=C({}),this.announcementText=C(""),this.showSettings=C(!1),k(()=>{this.rows().length>0&&this.recalculateTotals()}),k(()=>{this.started()&&this.finished()})}start(){this.storage.rows.set([]),this.storage.finished.set(null),this.storage.started.set(new Date().toISOString()),this.winners.set([]),this.newRow()}resume(){this.storage.finished.set(null),this.newRow()}abort(){this.storage.started.set(null),this.storage.finished.set(null),this.storage.rows.set([]),this.winners.set([]),this.totals.set({})}finish(){this.storage.finished.set(new Date().toISOString());const e={title:this.title(),started:this.started(),finished:this.finished(),players:this.players(),totals:this.totals()};this.storage.games.update(t=>[e,...t]),this.cleanupEmptyRows(),this.calculateWinners()}newRow(){const e={};for(const t of this.players())e[t.id]="";this.storage.rows.update(t=>[...t,e])}updateTotals(e){this.recalculateTotals(),this.storage.rows.update(t=>[...t])}recalculateTotals(){const e={};for(const t of this.players()){let n=0;for(const s of this.rows())n+=this.parseScore(s[t.id]);e[t.id]=n}this.totals.set(e),this.calculateWinners()}calculateWinners(){let e=-1/0,t=[];const n=this.totals();for(const s in n)n[s]>e?(e=n[s],t=[s]):n[s]===e&&t.push(s);this.winners.set(t)}cleanupEmptyRows(){const e=this.rows();e.length>0&&this.isRowEmpty(e[e.length-1])&&this.storage.rows.update(t=>t.slice(0,-1))}isRowEmpty(e){for(const t in e)if(this.parseScore(e[t])!==0)return!1;return!0}parseScore(e){if(!e)return 0;typeof e=="string"&&(e=e.replace(",","."));const t=parseFloat(e);return isNaN(t)?0:t}announce(){const e=this.totals(),t=[...this.players()].map(_=>({name:_.name,score:e[_.id]||0})).sort((_,w)=>w.score-_.score),n=this.tts();let s=n?.language;if(!s){const _=navigator.language;s=_&&_.indexOf("it")===0?"it-IT":"en-US"}let r="";if(s==="it-IT"){r="I punteggi attuali sono: ";for(const _ of t){const w=_.score===1?" punto. ":" punti. ";r+=`${_.name} con ${_.score}${w}`}}else{r="The current scores are: ";for(const _ of t){const w=_.score===1?" point. ":" points. ";r+=`${_.name} with ${_.score}${w}`}}this.announcementText.set(r),"speechSynthesis"in window?(window.speechSynthesis.cancel(),setTimeout(()=>{const _=new SpeechSynthesisUtterance(r);if(_.rate=n?.rate||.8,_.pitch=n?.pitch||1,_.lang=s,n?.voiceURI){const x=window.speechSynthesis.getVoices().find(j=>j.voiceURI===n.voiceURI);x&&(_.voice=x)}window.speechSynthesis.speak(_)},100)):console.warn("TTS not supported")}};M.ɵfac=function(t){return new(t||M)},M.ɵcmp=F({type:M,selectors:[["app-scores"]],decls:9,vars:7,consts:[[1,"container"],[1,"form-control","input-lg",2,"border","none","box-shadow","none","background","transparent","padding","0","height","auto",3,"ngModelChange","ngModel"],["class","alert alert-danger",4,"ngIf"],[4,"ngIf"],["class","scores-table",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["class","toolbar-right",4,"ngIf"],[3,"close",4,"ngIf"],[1,"alert","alert-danger"],["routerLink","/players",1,"alert-link"],[1,"scores-table"],[1,"table"],[3,"success",4,"ngFor","ngForOf"],["class","totals number",3,"success",4,"ngFor","ngForOf"],[3,"active","completed",4,"ngFor","ngForOf"],[1,"totals","number"],["class","number",4,"ngFor","ngForOf"],["class","btn btn-success",3,"click",4,"ngIf"],[1,"number"],[3,"submit"],["type","tel",1,"form-control","score-input",3,"ngModelChange","change","ngModel","ngModelOptions","disabled"],[1,"btn","btn-success",3,"click"],[1,"fa","fa-plus"],[1,"alert","alert-success"],[1,"toolbar-right"],[1,"btn","btn-default",3,"click"],[1,"fa","fa-wrench"],[1,"btn","btn-info",3,"click"],[1,"fa","fa-volume-up"],["class","btn btn-default",3,"click",4,"ngIf"],["class","btn btn-primary",3,"click",4,"ngIf"],["class","btn btn-danger",3,"click",4,"ngIf"],[1,"fa","fa-history"],[1,"btn","btn-primary",3,"click"],[1,"fa","fa-caret-square-o-right"],[1,"btn","btn-danger",3,"click"],[1,"fa","fa-trash-o"],[1,"fa","fa-check-square-o"],[3,"close"]],template:function(t,n){t&1&&(a(0,"div",0)(1,"h1")(2,"input",1),S("ngModelChange",function(r){return v(n.title,r)||(n.title=r),r}),u("ngModelChange",function(r){return n.title.set(r)}),i()(),f(3,rt,5,0,"div",2)(4,ct,3,4,"p",3)(5,dt,16,3,"div",4)(6,mt,3,2,"div",5)(7,yt,10,4,"div",6)(8,Tt,1,0,"app-settings",7),i()),t&2&&(c(2),y("ngModel",n.title),c(),g("ngIf",n.players().length===0),c(),g("ngIf",n.running()),c(),g("ngIf",n.players().length>0),c(),g("ngIf",n.winners().length>0),c(),g("ngIf",n.players().length>0),c(),g("ngIf",n.showSettings()))},dependencies:[U,N,Q,H,W,A,D,E,L,z,q,J,K,O],styles:[`.scores-table[_ngcontent-%COMP%]   .score-input[_ngcontent-%COMP%] {
  width: 80%;
  min-width: 3em;
  text-align: right;
}
.scores-table[_ngcontent-%COMP%]   tr.completed[_ngcontent-%COMP%]   input[_ngcontent-%COMP%] {
  border: none;
  background-color: transparent;
  -webkit-text-fill-color: #333;
}
.scores-table[_ngcontent-%COMP%]   tr.active[_ngcontent-%COMP%]   td[_ngcontent-%COMP%] {
  vertical-align: middle;
}
.scores-table[_ngcontent-%COMP%]   th.number[_ngcontent-%COMP%], 
.scores-table[_ngcontent-%COMP%]   td.number[_ngcontent-%COMP%] {
  text-align: right;
}
.scores-table[_ngcontent-%COMP%]   tfoot[_ngcontent-%COMP%]   th.number[_ngcontent-%COMP%] {
  padding-right: 0.7em;
}
.scores-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%] {
  text-align: center;
}`]});let P=M;export{P as ScoresComponent};
